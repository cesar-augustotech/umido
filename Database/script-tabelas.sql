-- Criação do banco de dados
CREATE DATABASE IF NOT EXISTS umido;
USE umido;

select * from usuario;

select avg(m.umidade) as umidade,extract(month from m.data_hora) as mes 
from medicao as m
inner join sensor as s on s.id = m.id_sensor
inner join unidade as u on u.id = s.id_unidade
where u.id = 1
group by mes
order by mes desc
limit 6;

select avg(m.umidade) as umidade,extract(week from m.data_hora) as semana
from medicao as m
inner join sensor as s on s.id = m.id_sensor
inner join unidade as u on u.id = s.id_unidade
where u.id = 1
group by semana
order by semana desc
limit 4;

desc medicao;
select count(alerta),id_sensor
from medicao as m
inner join sensor as s on s.id = m.id_sensor
inner join unidade as u on u.id = s.id_unidade
where u.id = 1
group by id_sensor;


select avg(m.umidade) as umidade,extract(hour from m.data_hora) as hora 
from medicao as m
inner join sensor as s on s.id = m.id_sensor
inner join unidade as u on u.id = s.id_unidade
where s.id = 1
group by hora
order by hora desc
limit 24;



       
CREATE TABLE empresa (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    cnpj VARCHAR(20) UNIQUE,
    telefone VARCHAR(20),
    ativo int default  0
);

-- Tabela de usuários
CREATE TABLE usuario (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    senha VARCHAR(100) NOT NULL,
    nivel_de_acesso ENUM('admin', 'comum') NOT NULL
);

-- Tabela de unidades (fazendas)
CREATE TABLE unidade ( 
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(100) NOT NULL,
    codigo_cnir VARCHAR(30),
    id_empresa INT NOT NULL,
    FOREIGN KEY (id_empresa) REFERENCES empresa(id)
);

-- Tabela de sensores
CREATE TABLE sensor (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_unidade INT NOT NULL,
    identificador VARCHAR(50) NOT NULL,
    ativo BOOLEAN DEFAULT TRUE,
    FOREIGN KEY (id_unidade) REFERENCES unidade(id)
);

-- Tabela de medições de umidade
CREATE TABLE medicao (
    id INT AUTO_INCREMENT PRIMARY KEY,
    id_sensor INT NOT NULL,
    umidade DECIMAL(5,2) NOT NULL, 
    data_hora DATETIME DEFAULT CURRENT_TIMESTAMP,
    alerta CHAR(1),
    FOREIGN KEY (id_sensor) REFERENCES sensor(id)
);

-- Relacionamento entre usuários e unidades (muitos-para-muitos)
CREATE TABLE unidade_usuario (
    id_unidade INT NOT NULL,
    id_usuario INT NOT NULL,
    PRIMARY KEY (id_unidade, id_usuario),
    FOREIGN KEY (id_unidade) REFERENCES unidade(id),
    FOREIGN KEY (id_usuario) REFERENCES usuario(id)
);


-- Criação dos usuários do sistema com permissões específicas
CREATE USER IF NOT EXISTS 'umido'@'localhost' IDENTIFIED BY 'Sptech#2024';
GRANT ALL PRIVILEGES ON umido.* TO 'umido'@'localhost';

CREATE USER IF NOT EXISTS 'umidoInsert'@'localhost' IDENTIFIED BY 'Sptech#2024';
GRANT INSERT ON umido.medicao TO 'umidoInsert'@'localhost';

FLUSH PRIVILEGES;
-- Inserção de dados iniciais

-- Empresas
INSERT INTO empresa (nome, cnpj,ativo) VALUES
    ('Sentinela','12.345.678/0001-99',1),
    ('Hydroscan','98.765.432/0001-11',1),
    ('CodeBerry', '10.765.432/0001-12',1),
    ('Projeto10','34.565.432/0001-11',0);

-- Usuários
INSERT INTO usuario (nome, email, senha, nivel_de_acesso) VALUES
    ('César Augusto','cesar@email','Sptech#2024','admin'),
    ('Bill Hebert','bill@email','Sptech#2024','comum'),
    ('Pedro Giraldi','pedro@email','Sptech#2024','comum'),
    ('Enzo Servilha','enzo@email.com','Sptech#2024','comum'),
    ('Felipe Hideki','felipe@email','Sptech#2024','comum'),
    ('Rafael','rafael@email','Sptech#2024','admin'),
    ('Pedro Rico','rico@email','Sptech#2024','comum'),
    ('Erick Araujo','erick@email','Sptech#2024','admin');

-- Unidades
INSERT INTO unidade (nome, codigo_cnir, id_empresa) VALUES
    ('Unidade Sentinela 1', 'CNIR-11', 1),
    ('Unidade Sentinela 2', 'CNIR-12', 1),
    ('Unidade Sentinela 3', 'CNIR-13', 1),
    ('Unidade Sentinela 4', 'CNIR-14', 1),
    ('Unidade Sentinela 5', 'CNIR-15', 1),
    ('Unidade HydroScan 1', 'CNIR-21', 2),
    ('Unidade HydroScan 2', 'CNIR-22', 2),
    ('Unidade CodeBerry 1', 'CNIR-31', 3);

-- Associação de usuários administradores a TODAS as unidades da empresa

-- César (empresa 1)
INSERT INTO unidade_usuario (id_unidade, id_usuario)
SELECT id, 1 FROM unidade WHERE id_empresa = 1;

-- Rafael (empresa 2)
INSERT INTO unidade_usuario (id_unidade, id_usuario)
SELECT id, 6 FROM unidade WHERE id_empresa = 2;

-- Erick (empresa 3)
INSERT INTO unidade_usuario (id_unidade, id_usuario)
SELECT id, 8 FROM unidade WHERE id_empresa = 3;

-- Associação de usuários comuns a unidades específicas
INSERT INTO unidade_usuario (id_unidade, id_usuario) VALUES
    (1, 2),
    (2, 3),
    (3, 4),
    (6, 5),
    (7, 7);

-- Sensores
INSERT INTO sensor (id_unidade, identificador) VALUES
    (1, 'SENT-1A'),
    (1, 'SENT-1B'),
    (2, 'SENT-2A'),
    (6, 'HYDR-1A'),
    (8, 'CODE-1A');

-- Medições (dados simulados)
INSERT INTO medicao (id_sensor, umidade, data_hora, alerta) VALUES
(1, 45.2, '2025-05-01 08:00:00', 0),
(1, 28.7, '2025-05-01 10:00:00', 1),
(1, 39.5, '2025-05-01 12:00:00', 0),
(1, 42.3, '2025-05-01 14:00:00', 0),
(1, 50.1, '2025-05-01 16:00:00', NULL),

(1, 43.0, '2025-05-02 08:00:00', 0),
(1, 25.9, '2025-05-02 10:00:00', 1),
(1, 31.2, '2025-05-02 12:00:00', 0),
(1, 48.5, '2025-05-02 14:00:00', 0),
(1, 53.7, '2025-05-02 16:00:00', NULL),

(1, 44.7, '2025-05-03 08:00:00', 0),
(1, 29.0, '2025-05-03 10:00:00', 1),
(1, 33.4, '2025-05-03 12:00:00', 0),
(1, 41.0, '2025-05-03 14:00:00', 0),
(1, 49.9, '2025-05-03 16:00:00', 0),

(1, 46.1, '2025-05-04 08:00:00', 0),
(1, 27.6, '2025-05-04 10:00:00', 1),
(1, 38.1, '2025-05-04 12:00:00', 0),
(1, 44.8, '2025-05-04 14:00:00', 0),
(1, 52.3, '2025-05-04 16:00:00', NULL),

(1, 48.5, '2025-05-05 08:00:00', 0),
(1, 26.3, '2025-05-05 10:00:00', 1),
(1, 37.5, '2025-05-05 12:00:00', 0),
(1, 43.6, '2025-05-05 14:00:00', 0),
(1, 51.0, '2025-05-05 16:00:00', NULL),

(1, 45.8, '2025-05-06 08:00:00', 0),
(1, 29.5, '2025-05-06 10:00:00', 1),
(1, 35.9, '2025-05-06 12:00:00', 0),
(1, 46.2, '2025-05-06 14:00:00', 0),
(1, 54.7, '2025-05-06 16:00:00', NULL),

(1, 47.3, '2025-05-07 08:00:00', 0),
(1, 27.9, '2025-05-07 10:00:00', 1),
(1, 38.3, '2025-05-07 12:00:00', 0),
(1, 45.1, '2025-05-07 14:00:00', 0),
(1, 53.2, '2025-05-07 16:00:00', NULL),

(1, 49.2, '2025-05-08 08:00:00', 0),
(1, 25.8, '2025-05-08 10:00:00', 1),
(1, 33.7, '2025-05-08 12:00:00', 0),
(1, 42.7, '2025-05-08 14:00:00', 0),
(1, 50.9, '2025-05-08 16:00:00', NULL),

(1, 46.5, '2025-05-09 08:00:00', 0),
(1, 28.0, '2025-05-09 10:00:00', 1),
(1, 36.2, '2025-05-09 12:00:00', 0),
(1, 44.3, '2025-05-09 14:00:00', 0),
(1, 51.7, '2025-05-09 16:00:00', NULL),

(1, 48.0, '2025-05-10 08:00:00', 0),
(1, 26.7, '2025-05-10 10:00:00', 1),
(1, 39.1, '2025-05-10 12:00:00', 0),
(1, 47.5, '2025-05-10 14:00:00', 0),
(1, 55.3, '2025-05-10 16:00:00', NULL),

(1, 45.6, '2025-05-11 08:00:00', 0),
(1, 27.2, '2025-05-11 10:00:00', 1),
(1, 34.9, '2025-05-11 12:00:00', 0),
(1, 41.8, '2025-05-11 14:00:00', 0),
(1, 49.0, '2025-05-11 16:00:00', 0),

(1, 47.1, '2025-05-12 08:00:00', 0),
(1, 25.5, '2025-05-12 10:00:00', 1),
(1, 37.3, '2025-05-12 12:00:00', 0),
(1, 43.2, '2025-05-12 14:00:00', 0),
(1, 51.4, '2025-05-12 16:00:00', NULL),

(1, 49.5, '2025-05-13 08:00:00', 0),
(1, 28.8, '2025-05-13 10:00:00', 1),
(1, 38.6, '2025-05-13 12:00:00', 0),
(1, 44.9, '2025-05-13 14:00:00', 0),
(1, 52.8, '2025-05-13 16:00:00', NULL),

(1, 46.8, '2025-05-14 08:00:00', 0),
(1, 27.0, '2025-05-14 10:00:00', 1),
(1, 34.3, '2025-05-14 12:00:00', 0),
(1, 43.7, '2025-05-14 14:00:00', 0),
(1, 50.5, '2025-05-14 16:00:00', NULL),

(1, 48.2, '2025-05-15 08:00:00', 0),
(1, 29.4, '2025-05-15 10:00:00', 1),
(1, 35.8, '2025-05-15 12:00:00', 0),
(1, 45.0, '2025-05-15 14:00:00', 0),
(1, 53.1, '2025-05-15 16:00:00', NULL),

(1, 45.4, '2025-05-16 08:00:00', 0),
(1, 25.7, '2025-05-16 10:00:00', 1),
(1, 37.9, '2025-05-16 12:00:00', 0),
(1, 42.6, '2025-05-16 14:00:00', 0),
(1, 49.6, '2025-05-16 16:00:00', 0),

(1, 47.7, '2025-05-17 08:00:00', 0),
(1, 28.3, '2025-05-17 10:00:00', 1),
(1, 33.6, '2025-05-17 12:00:00', 0),
(1, 43.4, '2025-05-17 14:00:00', 0),
(1, 51.2, '2025-05-17 16:00:00', NULL),

(1, 49.0, '2025-05-18 08:00:00', 0),
(1, 26.9, '2025-05-18 10:00:00', 1),
(1, 39.2, '2025-05-18 12:00:00', 0),
(1, 44.6, '2025-05-18 14:00:00', NULL),
(1, 52.0, '2025-05-18 16:00:00', NULL),

(1, 46.3, '2025-05-19 08:00:00', NULL),
(1, 27.5, '2025-05-19 10:00:00', 1),
(1, 35.1, '2025-05-19 12:00:00', 0),
(1, 42.9, '2025-05-19 14:00:00', NULL),
(1, 50.3, '2025-05-19 16:00:00', NULL),

(1, 48.6, '2025-05-20 08:00:00', NULL),
(1, 29.1, '2025-05-20 10:00:00', 1),
(1, 38.0, '2025-05-20 12:00:00', 0),
(1, 44.2, '2025-05-20 14:00:00', NULL),
(1, 53.0, '2025-05-20 16:00:00', NULL),

(1, 45.9, '2025-05-21 08:00:00', NULL),
(1, 25.4, '2025-05-21 10:00:00', 1),
(1, 34.8, '2025-05-21 12:00:00', 0),
(1, 41.5, '2025-05-21 14:00:00', NULL),
(1, 49.7, '2025-05-21 16:00:00', NULL),

(1, 47.4, '2025-05-22 08:00:00', NULL),
(1, 28.6, '2025-05-22 10:00:00', 1),
(1, 37.1, '2025-05-22 12:00:00', 0),
(1, 43.9, '2025-05-22 14:00:00', NULL),
(1, 52.4, '2025-05-22 16:00:00', NULL),

(1, 49.1, '2025-05-23 08:00:00', NULL),
(1, 26.2, '2025-05-23 10:00:00', 1),
(1, 36.5, '2025-05-23 12:00:00', 0),
(1, 45.3, '2025-05-23 14:00:00', NULL),
(1, 53.6, '2025-05-23 16:00:00', NULL),

(1, 46.6, '2025-05-24 08:00:00', NULL),
(1, 27.8, '2025-05-24 10:00:00', 1),
(1, 39.0, '2025-05-24 12:00:00', 0),
(1, 42.8, '2025-05-24 14:00:00', NULL),
(1, 50.8, '2025-05-24 16:00:00', NULL),

(1, 48.3, '2025-05-25 08:00:00', NULL),
(1, 25.6, '2025-05-25 10:00:00', 1),
(1, 33.9, '2025-05-25 12:00:00', 0),
(1, 44.5, '2025-05-25 14:00:00', NULL),
(1, 51.9, '2025-05-25 16:00:00', NULL),

(1, 45.7, '2025-05-26 08:00:00', NULL),
(1, 29.2, '2025-05-26 10:00:00', 1),
(1, 35.6, '2025-05-26 12:00:00', 0),
(1, 42.1, '2025-05-26 14:00:00', NULL),
(1, 49.4, '2025-05-26 16:00:00', NULL),

(1, 47.0, '2025-05-27 08:00:00', NULL),
(1, 27.3, '2025-05-27 10:00:00', 1),
(1, 37.7, '2025-05-27 12:00:00', 0),
(1, 43.0, '2025-05-27 14:00:00', NULL),
(1, 50.6, '2025-05-27 16:00:00', NULL),

(1, 49.4, '2025-05-28 08:00:00', NULL),
(1, 26.0, '2025-05-28 10:00:00', 1),
(1, 38.4, '2025-05-28 12:00:00', 0),
(1, 44.7, '2025-05-28 14:00:00', NULL),
(1, 53.4, '2025-05-28 16:00:00', NULL),

(1, 46.9, '2025-05-29 08:00:00', NULL),
(1, 28.4, '2025-05-29 10:00:00', 1),
(1, 34.5, '2025-05-29 12:00:00', 0),
(1, 43.3, '2025-05-29 14:00:00', NULL),
(1, 51.1, '2025-05-29 16:00:00', NULL),

(1, 47.2, '2025-05-30 08:00:00', NULL),
(1, 27.4, '2025-05-30 10:00:00', 1),
(1, 38.7, '2025-05-30 12:00:00', 0),
(1, 44.1, '2025-05-30 14:00:00', NULL),
(1, 51.0, '2025-05-30 16:00:00', NULL);

INSERT INTO medicao (id_sensor, umidade, data_hora, alerta) VALUES
(1, 46.2, '2025-05-31 08:00:00', 0),
(1, 28.5, '2025-05-31 10:00:00', 1),
(1, 33.7, '2025-05-31 12:00:00', 0),
(1, 52.1, '2025-05-31 14:00:00', NULL),
(1, 55.3, '2025-05-31 16:00:00', NULL),
(1, 47.8, '2025-06-01 08:00:00', 0),
(1, 29.4, '2025-06-01 10:00:00', 1),
(1, 34.9, '2025-06-01 12:00:00', 0),
(1, 50.7, '2025-06-01 14:00:00', NULL),
(1, 53.2, '2025-06-01 16:00:00', NULL),
(1, 48.1, '2025-06-02 08:00:00', 0),
(1, 26.3, '2025-06-02 10:00:00', 1),
(1, 36.2, '2025-06-02 12:00:00', 0),
(1, 51.6, '2025-06-02 14:00:00', NULL),
(1, 54.9, '2025-06-02 16:00:00', NULL),
(1, 45.9, '2025-06-03 08:00:00', 0),
(1, 27.8, '2025-06-03 10:00:00', 1),
(1, 39.0, '2025-06-03 12:00:00', 0),
(1, 53.4, '2025-06-03 14:00:00', NULL),
(1, 56.1, '2025-06-03 16:00:00', NULL),
(1, 46.5, '2025-06-04 08:00:00', 0),
(1, 25.6, '2025-06-04 10:00:00', 1),
(1, 35.3, '2025-06-04 12:00:00', 0),
(1, 50.9, '2025-06-04 14:00:00', NULL),
(1, 52.8, '2025-06-04 16:00:00', NULL),
(1, 49.7, '2025-06-05 08:00:00', 0),
(1, 28.1, '2025-06-05 10:00:00', 1),
(1, 37.5, '2025-06-05 12:00:00', 0),
(1, 53.9, '2025-06-05 14:00:00', NULL);

INSERT INTO medicao (id_sensor, umidade, data_hora, alerta) VALUES
(1, 28.0, '2025-01-01 08:00:00', 1),
(1, 45.0, '2025-01-02 08:00:00', 0),
(1, 52.0, '2025-01-03 08:00:00', NULL),
(1, 28.0, '2025-01-04 08:00:00', 1),
(1, 45.0, '2025-01-05 08:00:00', 0),
(1, 52.0, '2025-01-06 08:00:00', NULL),
(1, 28.0, '2025-01-07 08:00:00', 1),
(1, 45.0, '2025-01-08 08:00:00', 0),
(1, 52.0, '2025-01-09 08:00:00', NULL),
(1, 28.0, '2025-01-10 08:00:00', 1),
(1, 45.0, '2025-01-11 08:00:00', 0),
(1, 52.0, '2025-01-12 08:00:00', NULL),
(1, 28.0, '2025-01-13 08:00:00', 1),
(1, 45.0, '2025-01-14 08:00:00', 0),
(1, 52.0, '2025-01-15 08:00:00', NULL),
(1, 28.0, '2025-01-16 08:00:00', 1),
(1, 45.0, '2025-01-17 08:00:00', 0),
(1, 52.0, '2025-01-18 08:00:00', NULL),
(1, 28.0, '2025-01-19 08:00:00', 1),
(1, 45.0, '2025-01-20 08:00:00', 0),
(1, 52.0, '2025-01-21 08:00:00', NULL),
(1, 28.0, '2025-01-22 08:00:00', 1),
(1, 45.0, '2025-01-23 08:00:00', 0),
(1, 52.0, '2025-01-24 08:00:00', NULL),
(1, 28.0, '2025-01-25 08:00:00', 1),
(1, 45.0, '2025-01-26 08:00:00', 0),
(1, 52.0, '2025-01-27 08:00:00', NULL),
(1, 28.0, '2025-01-28 08:00:00', 1),
(1, 45.0, '2025-01-29 08:00:00', 0),
(1, 52.0, '2025-01-30 08:00:00', NULL),
(1, 28.0, '2025-01-31 08:00:00', 1),
(1, 45.0, '2025-02-01 08:00:00', 0),
(1, 52.0, '2025-02-02 08:00:00', NULL),
(1, 28.0, '2025-02-03 08:00:00', 1),
(1, 45.0, '2025-02-04 08:00:00', 0),
(1, 52.0, '2025-02-05 08:00:00', NULL),
(1, 28.0, '2025-02-06 08:00:00', 1),
(1, 45.0, '2025-02-07 08:00:00', 0),
(1, 52.0, '2025-02-08 08:00:00', NULL),
(1, 28.0, '2025-02-09 08:00:00', 1),
(1, 45.0, '2025-02-10 08:00:00', 0),
(1, 52.0, '2025-02-11 08:00:00', NULL),
(1, 28.0, '2025-02-12 08:00:00', 1),
(1, 45.0, '2025-02-13 08:00:00', 0),
(1, 52.0, '2025-02-14 08:00:00', NULL),
(1, 28.0, '2025-02-15 08:00:00', 1),
(1, 45.0, '2025-02-16 08:00:00', 0),
(1, 52.0, '2025-02-17 08:00:00', NULL),
(1, 28.0, '2025-02-18 08:00:00', 1),
(1, 45.0, '2025-02-19 08:00:00', 0),
(1, 52.0, '2025-02-20 08:00:00', NULL),
(1, 28.0, '2025-02-21 08:00:00', 1),
(1, 45.0, '2025-02-22 08:00:00', 0),
(1, 52.0, '2025-02-23 08:00:00', NULL),
(1, 28.0, '2025-02-24 08:00:00', 1),
(1, 45.0, '2025-02-25 08:00:00', 0),
(1, 52.0, '2025-02-26 08:00:00', NULL),
(1, 28.0, '2025-02-27 08:00:00', 1),
(1, 45.0, '2025-02-28 08:00:00', 0),
(1, 52.0, '2025-03-01 08:00:00', NULL),
(1, 28.0, '2025-03-02 08:00:00', 1),
(1, 28.0, '2025-03-02 08:00:00', 1),
(1, 45.0, '2025-03-03 08:00:00', 0),
(1, 52.0, '2025-03-04 08:00:00', NULL),
(1, 28.0, '2025-03-05 08:00:00', 1),
(1, 45.0, '2025-03-06 08:00:00', 0),
(1, 52.0, '2025-03-07 08:00:00', NULL),
(1, 28.0, '2025-03-08 08:00:00', 1),
(1, 45.0, '2025-03-09 08:00:00', 0),
(1, 52.0, '2025-03-10 08:00:00', NULL),
(1, 28.0, '2025-03-11 08:00:00', 1),
(1, 45.0, '2025-03-12 08:00:00', 0),
(1, 52.0, '2025-03-13 08:00:00', NULL),
(1, 28.0, '2025-03-14 08:00:00', 1),
(1, 45.0, '2025-03-15 08:00:00', 0),
(1, 52.0, '2025-03-16 08:00:00', NULL),
(1, 28.0, '2025-03-17 08:00:00', 1),
(1, 45.0, '2025-03-18 08:00:00', 0),
(1, 52.0, '2025-03-19 08:00:00', NULL),
(1, 28.0, '2025-03-20 08:00:00', 1),
(1, 45.0, '2025-03-21 08:00:00', 0),
(1, 52.0, '2025-03-22 08:00:00', NULL),
(1, 28.0, '2025-03-23 08:00:00', 1),
(1, 45.0, '2025-03-24 08:00:00', 0),
(1, 52.0, '2025-03-25 08:00:00', NULL),
(1, 28.0, '2025-03-26 08:00:00', 1),
(1, 45.0, '2025-03-27 08:00:00', 0),
(1, 52.0, '2025-03-28 08:00:00', NULL),
(1, 28.0, '2025-03-29 08:00:00', 1),
(1, 45.0, '2025-03-30 08:00:00', 0),
(1, 52.0, '2025-03-31 08:00:00', NULL),
(1, 28.0, '2025-04-01 08:00:00', 1),
(1, 45.0, '2025-04-02 08:00:00', 0),
(1, 52.0, '2025-04-03 08:00:00', NULL),
(1, 28.0, '2025-04-04 08:00:00', 1),
(1, 45.0, '2025-04-05 08:00:00', 0),
(1, 52.0, '2025-04-06 08:00:00', NULL),
(1, 28.0, '2025-04-07 08:00:00', 1),
(1, 45.0, '2025-04-08 08:00:00', 0),
(1, 52.0, '2025-04-09 08:00:00', NULL),
(1, 28.0, '2025-04-10 08:00:00', 1),
(1, 45.0, '2025-04-11 08:00:00', 0),
(1, 52.0, '2025-04-12 08:00:00', NULL),
(1, 28.0, '2025-04-13 08:00:00', 1),
(1, 45.0, '2025-04-14 08:00:00', 0),
(1, 52.0, '2025-04-15 08:00:00', NULL),
(1, 28.0, '2025-04-16 08:00:00', 1),
(1, 45.0, '2025-04-17 08:00:00', 0),
(1, 52.0, '2025-04-18 08:00:00', NULL),
(1, 28.0, '2025-04-19 08:00:00', 1),
(1, 45.0, '2025-04-20 08:00:00', 0),
(1, 52.0, '2025-04-21 08:00:00', NULL),
(1, 28.0, '2025-04-22 08:00:00', 1),
(1, 45.0, '2025-04-23 08:00:00', 0),
(1, 52.0, '2025-04-24 08:00:00', NULL),
(1, 28.0, '2025-04-25 08:00:00', 1),
(1, 45.0, '2025-04-26 08:00:00', 0),
(1, 52.0, '2025-04-27 08:00:00', NULL),
(1, 28.0, '2025-04-28 08:00:00', 1),
(1, 45.0, '2025-04-29 08:00:00', 0),
(1, 52.0, '2025-04-30 08:00:00', NULL);


INSERT INTO medicao (id_sensor, umidade, data_hora, alerta) VALUES
(2, 28.0, '2025-01-01 08:00:00', 1),
(2, 45.0, '2025-01-02 08:00:00', 0),
(2, 52.0, '2025-01-03 08:00:00', NULL),
(2, 28.0, '2025-01-04 08:00:00', 1),
(2, 45.0, '2025-01-05 08:00:00', 0),
(2, 52.0, '2025-01-06 08:00:00', NULL),
(2, 28.0, '2025-01-07 08:00:00', 1),
(2, 45.0, '2025-01-08 08:00:00', 0),
(2, 52.0, '2025-01-09 08:00:00', NULL),
(2, 28.0, '2025-01-10 08:00:00', 1),
(2, 45.0, '2025-01-11 08:00:00', 0),
(2, 52.0, '2025-01-12 08:00:00', NULL),
(2, 28.0, '2025-01-13 08:00:00', 1),
(2, 45.0, '2025-01-14 08:00:00', 0),
(2, 52.0, '2025-01-15 08:00:00', NULL),
(2, 28.0, '2025-01-16 08:00:00', 1),
(2, 45.0, '2025-01-17 08:00:00', 0),
(2, 52.0, '2025-01-18 08:00:00', NULL),
(2, 28.0, '2025-01-19 08:00:00', 1),
(2, 45.0, '2025-01-20 08:00:00', 0),
(2, 52.0, '2025-01-21 08:00:00', NULL),
(2, 28.0, '2025-01-22 08:00:00', 1),
(2, 45.0, '2025-01-23 08:00:00', 0),
(2, 52.0, '2025-01-24 08:00:00', NULL),
(2, 28.0, '2025-01-25 08:00:00', 1),
(2, 45.0, '2025-01-26 08:00:00', 0),
(2, 52.0, '2025-01-27 08:00:00', NULL),
(2, 28.0, '2025-01-28 08:00:00', 1),
(2, 45.0, '2025-01-29 08:00:00', 0),
(2, 52.0, '2025-01-30 08:00:00', NULL),
(2, 28.0, '2025-01-31 08:00:00', 1),
(2, 45.0, '2025-02-01 08:00:00', 0),
(2, 52.0, '2025-02-02 08:00:00', NULL),
(2, 28.0, '2025-02-03 08:00:00', 1),
(2, 45.0, '2025-02-04 08:00:00', 0),
(2, 52.0, '2025-02-05 08:00:00', NULL),
(2, 28.0, '2025-02-06 08:00:00', 1),
(2, 45.0, '2025-02-07 08:00:00', 0),
(2, 52.0, '2025-02-08 08:00:00', NULL),
(2, 28.0, '2025-02-09 08:00:00', 1),
(2, 45.0, '2025-02-10 08:00:00', 0),
(2, 52.0, '2025-02-11 08:00:00', NULL),
(2, 28.0, '2025-02-12 08:00:00', 1),
(2, 45.0, '2025-02-13 08:00:00', 0),
(2, 52.0, '2025-02-14 08:00:00', NULL),
(2, 28.0, '2025-02-15 08:00:00', 1),
(2, 45.0, '2025-02-16 08:00:00', 0),
(2, 52.0, '2025-02-17 08:00:00', NULL),
(2, 28.0, '2025-02-18 08:00:00', 1),
(2, 45.0, '2025-02-19 08:00:00', 0),
(2, 52.0, '2025-02-20 08:00:00', NULL),
(2, 28.0, '2025-02-21 08:00:00', 1),
(2, 45.0, '2025-02-22 08:00:00', 0),
(2, 52.0, '2025-02-23 08:00:00', NULL),
(2, 28.0, '2025-02-24 08:00:00', 1),
(2, 45.0, '2025-02-25 08:00:00', 0),
(2, 52.0, '2025-02-26 08:00:00', NULL),
(2, 28.0, '2025-02-27 08:00:00', 1),
(2, 45.0, '2025-02-28 08:00:00', 0),
(2, 52.0, '2025-03-01 08:00:00', NULL),
(2, 28.0, '2025-03-02 08:00:00', 1),
(2, 28.0, '2025-03-02 08:00:00', 1),
(2, 45.0, '2025-03-03 08:00:00', 0),
(2, 52.0, '2025-03-04 08:00:00', NULL),
(1, 28.0, '2025-03-05 08:00:00', 1),
(2, 45.0, '2025-03-06 08:00:00', 0),
(2, 52.0, '2025-03-07 08:00:00', NULL),
(2, 28.0, '2025-03-08 08:00:00', 1),
(2, 45.0, '2025-03-09 08:00:00', 0),
(2, 52.0, '2025-03-10 08:00:00', NULL),
(2, 28.0, '2025-03-11 08:00:00', 1),
(2, 45.0, '2025-03-12 08:00:00', 0),
(2, 52.0, '2025-03-13 08:00:00', NULL),
(2, 28.0, '2025-03-14 08:00:00', 1),
(2, 45.0, '2025-03-15 08:00:00', 0),
(2, 52.0, '2025-03-16 08:00:00', NULL),
(2, 28.0, '2025-03-17 08:00:00', 1),
(2, 45.0, '2025-03-18 08:00:00', 0),
(2, 52.0, '2025-03-19 08:00:00', NULL),
(2, 28.0, '2025-03-20 08:00:00', 1),
(2, 45.0, '2025-03-21 08:00:00', 0),
(2, 52.0, '2025-03-22 08:00:00', NULL),
(2, 28.0, '2025-03-23 08:00:00', 1),
(2, 45.0, '2025-03-24 08:00:00', 0),
(2, 52.0, '2025-03-25 08:00:00', NULL),
(2, 28.0, '2025-03-26 08:00:00', 1),
(2, 45.0, '2025-03-27 08:00:00', 0),
(2, 52.0, '2025-03-28 08:00:00', NULL),
(2, 28.0, '2025-03-29 08:00:00', 1),
(2, 45.0, '2025-03-30 08:00:00', 0),
(2, 52.0, '2025-03-31 08:00:00', NULL),
(2, 28.0, '2025-04-01 08:00:00', 1),
(2, 45.0, '2025-04-02 08:00:00', 0),
(2, 52.0, '2025-04-03 08:00:00', NULL),
(2, 28.0, '2025-04-04 08:00:00', 1),
(2, 45.0, '2025-04-05 08:00:00', 0),
(2, 52.0, '2025-04-06 08:00:00', NULL),
(2, 28.0, '2025-04-07 08:00:00', 1),
(2, 45.0, '2025-04-08 08:00:00', 0),
(2, 52.0, '2025-04-09 08:00:00', NULL),
(2, 28.0, '2025-04-10 08:00:00', 1),
(2, 45.0, '2025-04-11 08:00:00', 0),
(2, 52.0, '2025-04-12 08:00:00', NULL),
(2, 28.0, '2025-04-13 08:00:00', 1),
(2, 45.0, '2025-04-14 08:00:00', 0),
(2, 52.0, '2025-04-15 08:00:00', NULL),
(2, 28.0, '2025-04-16 08:00:00', 1),
(2, 45.0, '2025-04-17 08:00:00', 0),
(2, 52.0, '2025-04-18 08:00:00', NULL),
(2, 28.0, '2025-04-19 08:00:00', 1),
(2, 45.0, '2025-04-20 08:00:00', 0),
(2, 52.0, '2025-04-21 08:00:00', NULL),
(2, 28.0, '2025-04-22 08:00:00', 1),
(2, 45.0, '2025-04-23 08:00:00', 0),
(2, 52.0, '2025-04-24 08:00:00', NULL),
(2, 28.0, '2025-04-25 08:00:00', 1),
(2, 45.0, '2025-04-26 08:00:00', 0),
(2, 52.0, '2025-04-27 08:00:00', NULL),
(2, 28.0, '2025-04-28 08:00:00', 1),
(2, 45.0, '2025-04-29 08:00:00', 0),
(2, 52.0, '2025-04-30 08:00:00', NULL);

INSERT INTO medicao (id_sensor, umidade, data_hora, alerta) VALUES
(1, 52.0, '2025-06-07 01:00:00', NULL),
(1, 28.0, '2025-06-07 02:00:00', 1),
(1, 45.0, '2025-06-07 03:00:00', 0),
(1, 52.0, '2025-06-07 04:00:00', NULL),
(1, 28.0, '2025-06-07 05:00:00', 1),
(1, 45.0, '2025-06-07 06:00:00', 0),
(1, 52.0, '2025-06-07 07:00:00', NULL),
(1, 28.0, '2025-06-07 08:00:00', 1),
(1, 45.0, '2025-06-07 09:00:00', 0),
(1, 52.0, '2025-06-07 10:00:00', NULL),
(1, 28.0, '2025-06-07 11:00:00', 1),
(1, 45.0, '2025-06-07 12:00:00', 0),
(1, 52.0, '2025-06-07 13:00:00', NULL),
(1, 28.0, '2025-06-07 14:00:00', 1),
(1, 45.0, '2025-06-07 15:00:00', 0),
(1, 52.0, '2025-06-07 16:00:00', NULL),
(1, 28.0, '2025-06-07 17:00:00', 1),
(1, 45.0, '2025-06-07 18:00:00', 0),
(2, 52.0, '2025-06-09 19:00:00', NULL),
(2, 28.0, '2025-06-09 20:00:00', 1),
(2, 45.0, '2025-06-09 21:00:00', 0),
(1, 52.0, '2025-06-09 22:00:00', NULL),
(1, 28.0, '2025-06-09 23:00:00', 1),
(1, 28.0, '2025-06-09 00:00:00', 1);

select * from usuario;
 select m.id_sensor,s.identificador,
HOUR(m.data_hora) AS hora_do_dia,
avg(m.umidade)
from medicao as m
inner join sensor as s on s.id = m.id_sensor
inner join unidade as u on u.id = s.id_unidade
where u.id = 1 and data_hora >= DATE_SUB(now(), INTERVAL 24 hour)
group by m.id_sensor, hora_do_dia
order by m.id_sensor;
 

 select count(alerta) as alerta,id_sensor as sensor
from medicao as m
inner join sensor as s on s.id = m.id_sensor
inner join unidade as u on u.id = s.id_unidade
where u.id = 1
group by id_sensor;

 select truncate(avg(m.umidade),1) as umidade,extract(week from m.data_hora) as semana
from medicao as m
inner join sensor as s on s.id = m.id_sensor
inner join unidade as u on u.id = s.id_unidade
where u.id = 1
group by semana
order by semana desc
limit 4;



SELECT s.identificador,
m.umidade,
DATE_FORMAT(m.data_hora, '%H:%i:%s  %d/%m/%Y') as data,m.data_hora
from  medicao as m
inner join sensor as s on s.id = m.id_sensor
where id_unidade = 1  and data_hora >= DATE_SUB(now(), INTERVAL 48 hour) and alerta = (0 or 1)
order by data_hora desc
limit 28;

