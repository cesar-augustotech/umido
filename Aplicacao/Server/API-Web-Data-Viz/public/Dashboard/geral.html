<!DOCTYPE html>
<html lang="br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Umido - Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="..\css\dashboard.css">
</head>

<body>
  <header class="i_header">
    <div class="container">
      <div class="logo"></div>
      <nav>
        <input type="text" placeholder="Buscar...">
        <button class="botao_buscar">Buscar</button>
      </nav>
      <div class="div_perfil">
        <div>
          <h4>FERNANDO BRANDÃO</h4>
          <h5>Administrador</h5>
        </div>
        <img src="../assets/icons/user.png" style="width: 40px; height: 40px;" alt="perfil">
      </div>
    </div>
  </header>
  <div class="layout_principal">
    <div class="menu_lateral menu_expandido">
      <div class="botao_expandir" id="botao_expandir" onclick="botao_abrir_fechar_menu()">
        <img src="../assets/icons/seta.png" style="width: 20px; height: 20px;">
      </div>
      <ul class="itens_menu">
        <li style="gap: 20px;" onclick="window.location.href = 'geral.html'" class="ativo">
          <img src="../assets/icons/grafico.png" style="width: 30px; height: 30px;">
          <span>Painel</span>
        </li>
        <li style="gap: 20px;" onclick="window.location.href = 'relatorio.html'">
          <img src="../assets/icons/grafico.png" style="width: 30px; height: 30px;">
          <span>Relatórios</span>
        </li>
        <li style="gap: 20px;" onclick="window.location.href = 'configuracao.html'">
          <img src="../assets/icons/configuracao.png" style="width: 30px; height: 30px;">
          <span>Configurações</span>
        </li>
        <li style="gap: 20px;" onclick="window.location.href = '../index.html'">
          <img src="../assets/icons/sair.png" style="width: 30px; height: 30px;">
          <span>Sair</span>
        </li>
      </ul>
    </div>

    <section class="conteudo_principal">

      <div id="areaAlertas" class="cartao indicadores" style=" display: flex; justify-content: center;">

        <div class="indicadores" id="indicadores"></div>
      </div>

      <h1 class="valor_indicador">Matriz de Unidades</h1>
      <div class="indicadores" style="display: grid; grid-template-columns: 1fr 500px; ">
        
        <div id="areaUnidades" class="indicadores" style="grid-template-columns: 1fr 1fr 1fr; height: 200px;"></div>
        <div id="areaListaAlertas"></div>
      </div>

      <div class="modal_unidade" id="modalUnidade">
        <div class="conteudo_modal" style="max-width: 90vw; max-height: 90vh; overflow-y: auto;">
          <span class="fechar_modal" onclick="fecharModalUnidade()">&times;</span>
          <div id="target_div"></div>
          <iframe style="width:120%; height:120%; margin-left: -16%; margin-top:-6%; overflow-y: hidden"
            class="iframe_modal" src="./relatorio.html"></iframe>
        </div>
      </div>
    </section>
  </div>

</body>
<script>

  function botao_abrir_fechar_menu() {
    const menuLateral = document.querySelector('.menu_lateral');
    menuLateral.classList.toggle('menu_expandido');
    botao_expandir.classList.toggle('girar');
  }

  const unidades = [
    {
      id: 1, nome: "Unidade 1",
      responsaveis: ["César", "Dereck"],
      sensores: [
        { nome: "Sensor 1", umidade: "85%", alerta: 0 },
        { nome: "Sensor 2", umidade: "85%", alerta: 0 }
      ],
      outrasInfos: "Informações bem legais sobre essa unidade (descrição no banco de dados) (Ex:Localizada no setor norte.)"
    },
    {
      id: 2, nome: "Unidade 2",
      responsaveis: ["César, Bill"],
      sensores: [
        { nome: "Sensor 3", umidade: "30%", alerta: 1 },
        { nome: "Sensor 4", umidade: "30%", alerta: 1 }
      ],
      outrasInfos: "Informações bem legais sobre essa unidade (descrição no banco de dados)"
    },
    {
      id: 3, nome: "Unidade 3",
      responsaveis: ["César, Erick"],
      sensores: [
        { nome: "Sensor 5", umidade: "85%", alerta: 0 },
        { nome: "Sensor 6", umidade: "30%", alerta: 1 }
      ],
      outrasInfos: "Informações bem legais sobre essa unidade (descrição no banco de dados)"
    }, {
      id: 4, nome: "Unidade 4",
      responsaveis: ["César, Gustavo"],
      sensores: [
        { nome: "Sensor 7", umidade: "30%", alerta: 1 },
        { nome: "Sensor 8", umidade: "85%", alerta: 0 }
      ],
      outrasInfos: "Informações bem legais sobre essa unidade (descrição no banco de dados)"
    }, {
      id: 4, nome: "Unidade 4",
      responsaveis: ["César, Gustavo"],
      sensores: [
        { nome: "Sensor 7", umidade: "30%", alerta: 1 },
        { nome: "Sensor 8", umidade: "85%", alerta: 0 }
      ],
      outrasInfos: "Informações bem legais sobre essa unidade (descrição no banco de dados)"
    }, {
      id: 4, nome: "Unidade 4",
      responsaveis: ["César, Gustavo"],
      sensores: [
        { nome: "Sensor 7", umidade: "30%", alerta: 1 },
        { nome: "Sensor 8", umidade: "85%", alerta: 0 }
      ],
      outrasInfos: "Informações bem legais sobre essa unidade (descrição no banco de dados)"
    }, {
      id: 4, nome: "Unidade 4",
      responsaveis: ["César, Gustavo"],
      sensores: [
        { nome: "Sensor 7", umidade: "30%", alerta: 1 },
        { nome: "Sensor 8", umidade: "85%", alerta: 0 }
      ],
      outrasInfos: "Informações bem legais sobre essa unidade (descrição no banco de dados)"
    }, {
      id: 4, nome: "Unidade 4",
      responsaveis: ["César, Gustavo"],
      sensores: [
        { nome: "Sensor 7", umidade: "30%", alerta: 1 },
        { nome: "Sensor 8", umidade: "85%", alerta: 0 }
      ],
      outrasInfos: "Informações bem legais sobre essa unidade (descrição no banco de dados)"
    }

  ];

  let dadosSensores = [
    ["Sensor 1", "Ativo", "28%", "92%", "Ativo", [25, 27, 28, 30, 29, 28, 27, 26, 28, 29, 30, 28]],
    ["Sensor 2", "Ativo", "38%", "87%", "Ativo", [20, 21, 22, 34, 21, 22, 21, 26, 28, 29, 30, 28]],
    ["Sensor 3", "Ativo", "23%", "76%", "Ativo", [23, 24, 28, 32, 22, 23, 22, 26, 28, 29, 30, 28]],
    ["Sensor 4", "Ativo", "48%", "65%", "Ativo", [25, 28, 26, 35, 28, 26, 29, 26, 28, 29, 30, 28]],
    ["Sensor 5", "Ativo", "58%", "87%", "Ativo", [27, 27, 24, 37, 26, 29, 25, 26, 28, 29, 30, 28]]
  ];
  let paginaAtual = 1;
  const itensPorPagina = 10;


  function atualizarPaginaInicial() {
    const areaAlertas = document.getElementById("areaAlertas");
    const areaUnidades = document.getElementById("areaUnidades");

    areaUnidades.innerHTML = "";

    const alertas = unidades.filter(u => u.sensores.some(s => s.alerta === 1));
    const normais = unidades.filter(u => !alertas.includes(u));

    if (alertas.length) {
      const divAlerta = document.createElement("div");
      divAlerta.className = "cartao";
      divAlerta.innerHTML = `<h2>Unidades com Alerta</h2>`;
      alertas.forEach(u => {
        const btn = document.createElement("button");
        btn.className = "botao_buscar";
        btn.textContent = u.nome;
        btn.onclick = () => abrirModalUnidade(u.id);
        divAlerta.appendChild(btn);
      });
      areaAlertas.appendChild(divAlerta);
    }

    normais.concat(alertas).forEach(u => {
      const card = document.createElement("div");
      card.className = "cartao";
      card.style.cursor = "pointer";
      card.onclick = () => abrirModalUnidade(u.id);
      const minUmidade = Math.min(...u.sensores.map(sensor => parseInt(sensor.umidade)));
      card.innerHTML = `
  <h4>${u.nome}</h4>
    <p><small>${u.responsaveis.join(", ")}</small></p>
    <p class="valor_indicador"> ${minUmidade}%<p>
  ${u.sensores.some(s => s.alerta === 1)
          ? '<p class="info_adicional" style="color:#e84118;">Alerta ativo!</p>'
          : ''}
`;
      areaUnidades.appendChild(card);
    });
    criar_kpis();
    criar_lista_alertas();

    
  }

  function criar_kpis() {
    indicadores.innerHTML = ""

    let data = new Date()
    quantidade_alerta = parseInt(Math.random() * 10)
    let dadosIndicadores = [
      [quantidade_alerta, "incidentes", "(Mês atual)"],
      [parseInt(Math.random() * 70) + 30, "umidade média atual", "(Mês atual)"],
      [parseInt(Math.random() * 100), "exportações realizadas", "(Mês atual)"],
      [dadosSensores.length, "sensores em funcionamento", ""],
      [`${data.getHours()}:${data.getMinutes()}`, `${data.getDate()}/${data.getMonth() + 1}/${data.getFullYear()}`, "última atualização",]
    ];

    let elementoIndicadores = indicadores;
    for (let i = 0; i < dadosIndicadores.length; i++) {
      elementoIndicadores.innerHTML += `
        <div class="cartao">
            <div class="valor_indicador">${dadosIndicadores[i][0]}</div>
            <div class="descricao_indicador">${dadosIndicadores[i][1]}</div>
            <div class="info_adicional">${dadosIndicadores[i][2]}</div>
        </div>`;
    }
  }

  function criar_lista_alertas(){
    let html_lista =""
    let quantidade_alerta = parseInt(Math.random() * 10)
    let areaListaAlertas = document.getElementById("areaListaAlertas")
    for(let i =0;i<quantidade_alerta+5;i++){
        html_lista += `
        <tr>
            <td>Sensor ${i+1}</td>
            <td>${new Date().toLocaleString()}</td>
        ` 
    }
    let html = `
    <div class="container_grafico_mensal">
        <div class="cartao">
            <div class="valor_indicador">ALERTAS</div>
            <div class="descricao_indicador">Últimos alertas registrados (24h)</div><br>
            <table class="tabela_grafico">
                <tr>
                    <th>Sensor</th>
                    <th>Data</th>
                </tr>

           
                
            </div>
            <ul>
                ${html_lista}
            </ul>
        </div>
    </div>
    `
    
   areaListaAlertas.innerHTML = html
}


  function abrirModalUnidade(id) {
    const u = unidades.find(x => x.id === id);
   
    document.getElementById("modalUnidade").style.display = "block";
  }

  function fecharModalUnidade() {
    document.getElementById("modalUnidade").style.display = "none";
  }


  atualizarPaginaInicial();
</script>

</html>