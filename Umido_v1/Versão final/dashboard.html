<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    @import url("https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap");

    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
    }

    body {

        color: #333;
        line-height: 1.6;
    }

    .i_header {
        background: white;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .i_header .container {
        display: grid;
        grid-template-columns: 200px 1fr auto;
        align-items: center;
        padding: 15px 20px;
    }

    .logo {
        background-image: url("../assets/imgs/Log.png");
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-size: 100px;
        color: #00a8ff;
        font-weight: 700;
        width: 100%;
        height: 100%;
    }

    nav {
        display: flex;
        align-items: center;
    }

    nav input {
        padding: 8px 12px;
        border: 1px solid #ddd;
        border-radius: 4px 0 0 4px;
        width: 80%;
        outline: none;
    }



    .div_perfil {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .profile-pic {
        font-size: 32px;
        color: #00a8ff;
    }

    .layout_principal {
        display: grid;
        grid-template-columns: auto 1fr;
        height: calc(100vh - 70px);
    }

    .menu_lateral {
        background: white;
        color: #00a8ff;
        width: 50px;
        transition: width 0.3s;
        position: relative;
        font-size: 0px;
        box-shadow: 0 2px 10px rgb(0 0 0 / 30%);
    }

    .menu_expandido {
        width: 200px;
        font-size: 15px;
        animation: animacao_fonte 0.3s forwards;
    }

    @keyframes animacao_fonte {
        0% {
            font-size: 0px;
        }

        100% {
            font-size: 15px;
        }
    }

    .botao_expandir {
        position: absolute;
        right: 0px;
        background: #00aaff86;
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

    .itens_menu {
        padding: 50px 0px 0px 0px;
    }

    .itens_menu li {
        display: flex;
        align-items: center;
        padding: 12px 20px 12px 10px;
        cursor: pointer;
        transition: background 0.3s;
    }

    .itens_menu li.ativo {
        background: #00aaff86;
        color: white;
    }

    .itens_menu li i {
        margin-right: 10px;
    }

    .conteudo_principal {
        padding: 20px;
        overflow: auto;
    }
    

    .cartao {
        background: white;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgb(0 0 0 / 30%);
        padding: 20px;
        margin-bottom: 20px;
    }

    .indicadores {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 20px;
    }

    .indicadores .cartao {
        text-align: center;
    }

    .valor_indicador {
        font-size: 28px;
        font-weight: 700;
        color: #00a8ff;
    }

    .descricao_indicador {
        font-size: 14px;
        margin-top: 5px;
    }

    .info_adicional {
        font-size: 12px;
        color: #777;
    }

    .secao_monitoramento {
        display: grid;
        grid-template-columns: 1fr 350px;
        gap: 20px;
        margin-bottom: 20px;
    }

    .titulo_grafico,
    .titulo_sensores {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .container_grafico {
        height: 100%;
        width: 100%;
        display: flex;
        justify-content: center;
    }

    .botao_adicionar {
        background-color: #00a8ff;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 5px 10px;
        font-size: 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .lista_sensores {
        list-style: none;
        height: 300px;
        overflow-y: auto;
    }

    .lista_sensores li {
        display: flex;
        justify-content: space-between;
        padding: 12px 15px;
        border-bottom: 1px solid #eee;
        align-items: center;
        cursor: pointer;
    }

    .status_sensor {
        padding: 5px 10px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: 500;
    }

    .status_sensor.ativo {
        background-color: #28a745;
        color: white;
    }

    .graficos_mensais {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        width: 100%;
        height: 100%;
        gap: 20px;
    }

    .container_grafico_mensal {
        width: 100%;
        height: 100%;
        
    }
    .container_grafico_mensal .cartao {
        width: 100%;
        height: 100%;
        background-color: white;
    }

    .girar {
        transform: rotate(180deg);
        transition: transform 0.3s;
    }

    .popup_sensor,
    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        overflow: auto;
    }

    .conteudo_popup,
    .conteudo_modal {
        background-color: white;
        margin: 10% auto;
        padding: 20px;
        width: 80%;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        position: relative;
        height: 500px;
    }

    .conteudo_popup {
        max-width: 800px;
        max-height: 500px;
    }

    .conteudo_modal {
        max-width: 500px;
    }

    .fechar_popup,
    .fechar_modal {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 28px;
        font-weight: bold;
        color: #aaa;
        cursor: pointer;
    }

    .grafico_sensor {
        height: 200px;
    }

    .grupo_formulario {
        margin-bottom: 20px;
    }

    .grupo_formulario label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #333;
    }

    .grupo_formulario input,
    .grupo_formulario select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
    }

    .botao_cancelar {
        background-color: #f1f1f1;
        color: #333;
        border: none;
        border-radius: 4px;
        padding: 10px 15px;
        cursor: pointer;
        font-size: 16px;
    }

    .botao_salvar {
        background-color: #00a8ff;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 10px 15px;
        cursor: pointer;
        font-size: 16px;
    }

    .botao_buscar {
        background-color: #00a8ff;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 16px;
    }
</style>

<header class="i_header">
    <div class="container">
        <div class="logo">

        </div>

        <nav>
            <input type="text" placeholder="Buscar...">
            <button class="botao_buscar">Buscar</button>
        </nav>

        <div class="div_perfil">
            <div>
                <h4>FERNANDO BRANDÃO</h4>
                <h5>Administrador</h5>
            </div>
            <img src="../assets/icons/user.png" style="width: 40px; height: 40px;" alt="perfil">
        </div>
    </div>
</header>
<div class="layout_principal">
    <div class="menu_lateral menu_expandido">
        <div class="botao_expandir" id="botao_expandir" onclick="abrir_fechar_menu()">
            <img src="../assets/icons/seta.png" style="width: 20px; height: 20px;">
        </div>
        <ul class="itens_menu">
            <li style="gap: 20px;" class="ativo">
                <img src="../assets/icons/grafico.png" style="width: 30px; height: 30px;">
                <span>Painel</span>
            </li>
            <li style="gap: 20px;">
                <img src="../assets/icons/configuracao.png" style="width: 30px; height: 30px;">
                <span>Configurações</span>
            </li>
            <li style="gap: 20px;">
                <img src="../assets/icons/sair.png" style="width: 30px; height: 30px;">
                <span>Sair</span>
            </li>
        </ul>
    </div>

    <section class="conteudo_principal">
        <div class="cartao">
            <div class="indicadores" id="indicadores"></div>

            <div class="secao_monitoramento">
                <div class="cartao">
                    <div class="titulo_grafico">Umidade por Período</div>
                    <div class="container_grafico">
                        <canvas id="grafico_umidade"></canvas>
                    </div>
                </div>
                <div class="cartao">
                    <div class="titulo_sensores">Lista de sensores
                        <button id="botao_adicionar_sensor" onclick="mostrarModal()" class="botao_adicionar">Novo Sensor</button>
                    </div>
                    <div class="lista_botoes">
                        <ul class="lista_sensores" id="lista_sensores"></ul>
                    </div>
                </div>
            </div>

            <div style="width: 100%; height: 100%; display: grid ; grid-template-rows: 20px 1fr;">
                <div class="titulo_grafico">ESTATÍSTICAS DO MÊS</div>
                <div class="graficos_mensais" id="graficos_mensais"></div>
            </div>
        </div>
    </section>
</div>

<div id="popup_sensor" class="popup_sensor">
    <div class="conteudo_popup">
        <span class="fechar_popup" onclick="fecharPopup()">&times;</span>
        <h2 id="titulo_popup_sensor">Sensor X</h2>
        <div class="metricas_sensor">
            <div class="cartao_metrica">
                <h3>Umidade Atual</h3>
                <div class="valor_metrica" id="umidade_sensor">--</div>
            </div>
            <div class="cartao_metrica">
                <h3>Bateria</h3>
                <div class="valor_metrica" id="bateria_sensor">--</div>
            </div>
            <div class="cartao_metrica">
                <h3>Status</h3>
                <div class="valor_metrica" id="status_sensor">--</div>
            </div>
        </div>
        <div class="grafico_sensor">
            <h3>Histórico de Umidade (24h)</h3>
            <canvas id="grafico_historico_sensor"></canvas>
        </div>
    </div>
</div>

<div id="modal_adicionar_sensor" class="modal">
    <div class="conteudo_modal">
        <span class="fechar_modal" id="fechar_modal" onclick="fecharModalSensor()">&times;</span>
        <h2>Adicionar Novo Sensor</h2>
        <form id="formulario_adicionar_sensor">
            <div class="grupo_formulario">
                <label for="nome_sensor">Nome do Sensor:</label>
                <input type="text" id="nome_sensor" required placeholder="Ex: Sensor 11">
            </div>
            <div class="grupo_formulario">
                <label for="localizacao_sensor">Localização:</label>
                <input type="text" id="localizacao_sensor" required placeholder="Ex: Área E">
            </div>
            <div class="grupo_formulario">
                <label for="tipo_sensor">Tipo de Sensor:</label>
                <select id="tipo_sensor" required>
                    <option value="">Selecione um tipo</option>
                    <option value="umidade">Umidade</option>
                </select>
            </div>
            <div class="grupo_formulario">
                <label for="intervalo_sensor">Intervalo de Leitura (minutos):</label>
                <input type="number" id="intervalo_sensor" min="1" max="60" value="15">
            </div>
            <div class="botoes_formulario">
                <button type="button" class="botao_cancelar" onclick="fecharModalSensor()"
                    id="botao_cancelar">Cancelar</button>
                <button type="submit" class="botao_salvar" onclick="salvarFormulario()">Salvar Sensor</button>
            </div>
        </form>
    </div>
</div>

<script>

    function abrir_fechar_menu() {
        const menuLateral = document.querySelector('.menu_lateral');
        menuLateral.classList.toggle('menu_expandido');
        botao_expandir.classList.toggle('girar');
    }

    let contexto = document.getElementById('grafico_umidade').getContext('2d');
    let graficoUmidade = new Chart(contexto, {
        type: "line",
        data: {
            labels: ["Novembro","Dezembro","Janeiro", "Fevereiro", "Março", "Abril"],
            datasets: [{
                label: "Umidade (%)",
                data: [65,60,85, 72, 65, 78],
                backgroundColor: 'rgba(0, 168, 255, 0.2)',
                borderColor: 'rgba(0, 168, 255, 1)',
                borderWidth: 2,
                fill: true
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });


    let dadosIndicadores = [
        [4, "incidentes", "(Mês atual)"],
        [30, "umidade média atual", ""],
        [10, "sensores em funcionamento", ""],
        [10, "dados exportados", "(Mês atual)"],
        [13, "última atualização", ""]
    ];


    let elementoIndicadores = indicadores;
    for (let i = 0; i < dadosIndicadores.length; i++) {
        elementoIndicadores.innerHTML += `
        <div class="cartao">
            <div class="valor_indicador">${dadosIndicadores[i][0]}</div>
            <div class="descricao_indicador">${dadosIndicadores[i][1]}</div>
            <div class="info_adicional">${dadosIndicadores[i][2]}</div>
        </div>`;
    }

    let dadosGraficos = [
        ["grafico_mensal", "Umidade", "Umidade (%)", "bar", ["Semana 1", "Semana 2", "Semana 3", "Semana 4"], [85, 72, 65, 78],"lengenda1"],
        ["grafico_incidentes", "Incidentes por Área", "Incidentes", "pie", ["Área A", "Área B", "Área C", "Área D"], [1, 2, 0, 1],"lengenda2"],
        ["grafico_desempenho", "Desempenho do Sistema", "Desempenho (%)", "radar", ["Precisão", "Resposta", "Tempo Ativo", "Conectividade", "Eficiência"], [95, 85, 99, 92, 88],"lengenda3"]
    ];

    let elementoGraficosMensais = graficos_mensais;
    for (let i = 0; i < dadosGraficos.length; i++) {
        elementoGraficosMensais.innerHTML += `
        <div class="container_grafico_mensal">
            <div class="cartao">
                <div class="titulo_grafico">${dadosGraficos[i][1]}</div>
                <div class="titulo_grafico">${dadosGraficos[i][6]}</div>
                <div class="container_grafico">
                    <canvas id="${dadosGraficos[i][0]}" style="height: 50%; width: 100%;"></canvas>
                </div>
            </div>
        </div>`;
    }

    for (let i = 0; i < dadosGraficos.length; i++) {
        let contexto = document.getElementById(dadosGraficos[i][0]).getContext('2d');
        let grafico = new Chart(contexto, {
            type: dadosGraficos[i][3],
            data: {
                labels: dadosGraficos[i][4],
                datasets: [{
                    label: dadosGraficos[i][2],
                    data: dadosGraficos[i][5],
                    backgroundColor: 'rgba(0, 168, 255, 0.2)',
                    borderColor: 'rgba(0, 168, 255, 1)',
                    borderWidth: 2,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    let dadosSensores = [
        ["Sensor 1", "Ativo", "28%", "92%", "Ativo", [25, 27, 28, 30, 29, 28, 27, 26, 28, 29, 30, 28]],
        ["Sensor 2", "Ativo", "38%", "87%", "Ativo", [20, 21, 22, 34, 21, 22, 21, 26, 28, 29, 30, 28]],
        ["Sensor 3", "Ativo", "23%", "76%", "Ativo", [23, 24, 28, 32, 22, 23, 22, 26, 28, 29, 30, 28]],
        ["Sensor 4", "Ativo", "48%", "65%", "Ativo", [25, 28, 26, 35, 28, 26, 29, 26, 28, 29, 30, 28]],
        ["Sensor 5", "Ativo", "58%", "87%", "Ativo", [27, 27, 24, 37, 26, 29, 25, 26, 28, 29, 30, 28]]
    ];

    let elementoListaSensores = lista_sensores;
    for (let i = 0; i < dadosSensores.length; i++) {
        elementoListaSensores.innerHTML += `
        <li>
            <span class="nome_sensor">${dadosSensores[i][0]}</span>
            <span class="status_sensor ativo" onclick="abrirPopupSensor(${i})">${dadosSensores[i][1]}</span>
        </li>`;
    }

    function abrirPopupSensor(posicao) {
        const popup = popup_sensor;
        const tituloPopup = titulo_popup_sensor;
        const umidadeSensor = umidade_sensor;
        const bateriaSensor = bateria_sensor;
        const statusSensor = status_sensor;

        tituloPopup.textContent = dadosSensores[posicao][0];
        umidadeSensor.textContent = dadosSensores[posicao][2];
        bateriaSensor.textContent = dadosSensores[posicao][3];
        statusSensor.textContent = dadosSensores[posicao][4];

        popup.style.display = 'block';

        criarGraficoSensor(dadosSensores[posicao][5]);
    }

    function criarGraficoSensor(dados) {
        const contexto = document.getElementById('grafico_historico_sensor').getContext('2d');
        if (window.graficoHistoricoSensor) {
            window.graficoHistoricoSensor.destroy();
        }

        const horas = [];
        const agora = new Date();
        for (let i = 11; i >= 0; i--) {
            const hora = new Date(agora);
            hora.setHours(agora.getHours() - i);
            horas.push(hora.getHours() + ':00');
        }

        window.graficoHistoricoSensor = new Chart(contexto, {
            type: 'line',
            data: {
                labels: horas,
                datasets: [{
                    label: 'Umidade (%)',
                    data: dados,
                    borderColor: '#00a8ff',
                    backgroundColor: 'rgba(0, 168, 255, 0.1)',
                    fill: true,
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        min: Math.min(...dados) - 5,
                        max: Math.max(...dados) + 5
                    }
                }
            }
        });
    }

    function fecharPopup() {
        popup_sensor.style.display = 'none';
    }

    const modalAdicionarSensor = modal_adicionar_sensor;
    const formularioAdicionarSensor = formulario_adicionar_sensor;

    function mostrarModal() {
        modalAdicionarSensor.style.display = 'block';
    }

    function fecharModalSensor() {
        modalAdicionarSensor.style.display = 'none';
        formularioAdicionarSensor.reset();
    }

    function salvarFormulario() {
        const nome = nome_sensor.value;
        lista_sensores.innerHTML += `
        <li>
            <span class="nome_sensor">${nome}</span>
            <span class="status_sensor ativo" onclick="abrirPopupSensor(${dadosSensores.length})">Ativo</span>
        </li>`;
        fecharModalSensor();
        return false;
    }
</script>